/*
 * This file was generated by the Gradle 'init' task.
 *
 * This project uses @Incubating APIs which are subject to change.
 */

plugins {
    id 'java-library'
    id 'org.springframework.boot' version '2.5.2'
    id 'io.spring.dependency-management' version '1.0.15.RELEASE'
    id 'maven-publish'
}
group = 'us.ampre'
version = '1.0.0-SNAPSHOT'
description = 'Java Rets Client'
java.sourceCompatibility = JavaVersion.VERSION_17

dependencies {
    implementation 'org.springframework.boot:spring-boot-starter'
    api 'jdom:jdom:1.0'
    api 'commons-lang:commons-lang:2.4'
    api 'commons-codec:commons-codec:1.3'
    api 'com.google.guava:guava:11.0.1'
    api 'org.apache.httpcomponents:httpclient:4.1.1'
    api 'org.apache.httpcomponents:httpcore:4.1'

//    implementation group: 'org.apache.httpcomponents.client5', name: 'httpclient5', version: '5.2.1'
//    implementation group: 'org.apache.httpcomponents.core5', name: 'httpcore5-h2', version: '5.2.1'

    compileOnly 'org.projectlombok:lombok'
    developmentOnly 'org.springframework.boot:spring-boot-devtools'
    annotationProcessor 'org.projectlombok:lombok'
    testImplementation 'org.springframework.boot:spring-boot-starter-test'
    testImplementation 'junit:junit:3.8.1'
}

repositories {
    // AMP Nexus Repos
    maven {
        url = 'https://nexus.dev.ampre.ca/repository/Shibboleth-Proxy/'
        credentials {
            username = nexusTokenUser
            password = nexusTokenPassword
        }
        authentication {
            basic(BasicAuthentication)
        }
    }
    maven {
        url = 'https://nexus.dev.ampre.ca/repository/maven-central/'
        credentials {
            username = nexusTokenUser
            password = nexusTokenPassword
        }
        authentication {
            basic(BasicAuthentication)
        }
    }
    maven {
        url = 'https://nexus.dev.ampre.ca/repository/AMP-Release-Maven/'
        credentials {
            username = nexusTokenUser
            password = nexusTokenPassword
        }
        authentication {
            basic(BasicAuthentication)
        }
    }
    maven {
        url = 'https://nexus.dev.ampre.ca/repository/AMP-Snapshot-Maven/'
        credentials {
            username = nexusTokenUser
            password = nexusTokenPassword
        }
        authentication {
            basic(BasicAuthentication)
        }
    }
    maven {
        url = 'https://nexus.dev.ampre.ca/repository/third-party/'
        credentials {
            username = nexusTokenUser
            password = nexusTokenPassword
        }
        authentication {
            basic(BasicAuthentication)
        }
    }
}

publishing {
    publications {
        ampapi(MavenPublication) {
            artifact bootJar
            from components.java
            versionMapping {
                usage('java-api') {
                    fromResolutionOf('runtimeClasspath')
                }
                usage('java-runtime') {
                    fromResolutionResult()
                }
            }
        }
    }

    repositories {
        maven {
            if(project.version.endsWith('-SNAPSHOT')) {
                url = 'https://nexus.dev.ampre.ca/repository/AMP-Snapshot-Maven/'
            } else {
                url = 'https://nexus.dev.ampre.ca/repository/AMP-Release-Maven/'
            }
            credentials {
                username = nexusTokenUser
                password = nexusTokenPassword
            }
            authentication {
                basic(BasicAuthentication)
            }
        }
    }
}

test {
    useJUnitPlatform()
}

configurations.all {
    resolutionStrategy.cacheChangingModulesFor 0, 'seconds'
}

configurations {
    compileOnly {
        extendsFrom annotationProcessor
    }
}

tasks.named('test') {
    useJUnitPlatform()
}
